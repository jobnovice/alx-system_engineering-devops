#!/usr/bin/env bash

apt-get -y update
apt-get -y install nginx

nginx_conf='/etc/nginx/sites-available/default'

new_conf="location /redirect_me {
    rewrite ^/redirect_me(.*) http://www.google.com permanent;
}

location / {
    try_files \$uri \$uri/ =404;
}"

# Use sed to replace the old location block with the new one
sudo sed -i '/location \/ {/,/}/{/location \/ {/{N;s/location \/ {\n/'"$new_conf"'\n/}}' $nginx_conf

# Test the Nginx configuration
nginx -t

# If the configuration test is successful, restart Nginx to apply the changes
if [ $? -eq 0 ]; then
   sudo service nginx restart
else
    echo "Nginx configuration test failed. Check the error messages above."
fi
